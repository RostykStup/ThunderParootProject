<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Category_Admin</title>
    <link rel="stylesheet"   href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body>

<!--<a class="waves-effect waves-light btn modal-trigger" href="#modal1">Modal</a>-->
<button data-target="modal1" class="btn modal-trigger">Create</button>
<div id="modal1" class="modal">
    <div class="modal-content">
        <input type="text" id="category-name" placeholder="name">
        <input type="text" id="category-id" style="display: none">
        <button id="category-create-button" class="btn" >Create</button>
        <button id="close-button" class = "btn" style="background-color: white; color: black">Cancel</button>
    </div>
</div>

<script>
    $(document).ready(function(){
        $('.modal').modal();
    });
    $('#category-create-button').click(() => {
        let id = $('#category-id').val();
        if(id === ''){
            let request = {
                name: $('#category-name').val()
            }
            $.ajax({
                url: 'http://localhost:8080/category',
                contentType: 'application/json',
                type: 'post',
                data: JSON.stringify(request),
                success: function (response) {
                    console.log('post', response);
                    $('.modal').modal('close');
                    $('#category-name').val('');
                    location.reload();
                    // redrawTable();
                }
            });
        } else {
            let request = {
                id:$('#category-id').val(),
                name: $('#category-name').val()
            }
            $.ajax({
                url: 'http://localhost:8080/category?id='+id,
                contentType: 'application/json',
                type: 'put',
                data: JSON.stringify(request),
                success: function (response) {
                    console.log('update', response);
                    $('.modal').modal('close');
                    $('#category-name').val('');
                    $('#category-id').val('');
                    location.reload();
                    // redrawTable();
                }
            });

        }
    });

    $('#close-button').click(() => {
        $('.modal').modal('close');
        $('#category-name').val('');
        $('#category-id').val('');
    });

</script>

<table id="categories_table">
    <thead>
    <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="categories">

    </tbody>
</table>

<script>
    redrawTable();
    function redrawTable() {
        $("#categories tr").remove();
        $.ajax({
            url: 'http://localhost:8080/category',
            type: 'get',
            success: function (response) {
                for (let category of response) {
                    appendCountryToTable(category);
                }
                actionsOnDeleteButton();
                actionsOnUpdateButton()
            }

        })
    }
    function appendCountryToTable(category) {
        $('#categories').append(`
            <tr>
             <td class="category-id-col">${category.id}</td>
             <td class="category-name-col">${category.name}</td>
                 <td>
                  <button value="${category.id}" class="delete-btn btn">Delete
                  </button>
                 <button value="${category.id}" class="update-btn btn">Update
                 </button>
                  </td>
             </tr>
        `);
    };
    
    function actionsOnDeleteButton() {
        $('.delete-btn').click((e) =>{
            let id = e.target.value;
            $.ajax({
                url: 'http://localhost:8080/category?id='+id,
                type: 'delete',
                success: function () {
                   console.log('deleted');
                   location.reload();
                    // redrawTable();
                }
            })
        });
    };
    
    function actionsOnUpdateButton() {
        $('.update-btn').click((e) =>{
            let id = e.target.value;
            let $btn = $(e.target);
            $('#category-name').val($btn.parent().siblings('.category-name-col').html());
            $('#category-id').val(id);
            $('.modal').modal('open');
        });
    };
</script>
</body>
</html>